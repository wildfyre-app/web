<md-spinner *ngIf="loading"></md-spinner>
<br>
<md-card class="example-card" *ngIf="!loading">
  <button id="topNavBack" md-button (click)="back()"><i class="material-icons">arrow_back</i></button>
  <a *ngIf="post?.image" href="{{post?.image}}"><img src="{{post?.image}}" /></a>
  <span class="mainText" innerHTML="{{post?.text | marked: post}}"></span>
  <md-card (click)="gotoUser(post?.author?.user)" class="parentContainer1">
    <div class="parentContainer">
      <img class="pfp2" (click)="gotoUser(post?.author?.user)" *ngIf="post?.author?.avatar" [src]="post?.author?.avatar" alt="Avatar of {{post?.author?.name}}"/>
      <img class="pfp2" (click)="gotoUser(post?.author?.user)" *ngIf="!post?.author?.avatar" src="/assets/logo.png" alt="Avatar of {{post?.author?.name}}"/>
      <ng-container class="user">
        <br>
      <i><small><a routerLink="/user/{{post?.author?.user}}" class="dateText" (click)="gotoUser(post?.author?.user)" routerLinkActive="active">{{post?.author?.name}}</a><br> <p>{{post?.created}}</p></small></i>
    </ng-container>
    </div>
  </md-card>

  <div class="postEditing">
    <div class="commentCircle" *ngIf="post?.comments?.length !== 0">{{getCommentLength(post?.comments?.length)}}</div>
    <button *ngIf="!post?.subscribed" md-icon-button (click)="subscribe(true)"><i class="material-icons">turned_in_not</i></button>
    <button *ngIf="post?.subscribed" md-icon-button (click)="subscribe(false)"><i class="material-icons">turned_in</i></button>
    <button md-icon-button [mdMenuTriggerFor]="appMenu"><i class="material-icons">more_vert</i></button>
    <md-menu #appMenu="mdMenu">
      <button md-menu-item type="button" (click)="ngOnInit()"><md-icon>refresh</md-icon>Refresh Post</button>
      <button md-menu-item type="button" (click)="share()"><md-icon>share</md-icon>Share Post</button>
      <button *ngIf="post?.author?.user == userID" md-menu-item color="warn" (click)="openPostDeleteDialog()"><md-icon>delete</md-icon>Delete Post</button>
      <button *ngIf="!(post?.author?.user == userID) && loggedIn" md-menu-item (click)="openFlagDialog(post, null, typeOfReport.Post)"><md-icon>flag</md-icon>Flag Post</button>
    </md-menu>
  </div>
  <br>
</md-card>

<div *ngIf="expanded && loggedIn" id="focusTouchZone" (click)="contractBox()"></div>
<textarea [style.bottom]="styleTextBottom" *ngIf="loggedIn" [style.height]="heightText" class="commentBox" (click)="expandBox()" name="comment" rows="{{rowsExapanded}}" cols="40" type="text" [(ngModel)]="model.comment" #comment="ngModel" placeholder="Post a Comment"></textarea>
<button [style.bottom]="styleEditorBottom" *ngIf="expanded && loggedIn" id="editorButton" (click)="$event.stopPropagation();" md-button color="accent" [disabled]="loading" [mdMenuTriggerFor]="commentMenu"><i class="material-icons">text_format</i></button>
<button [style.bottom]="styleCommentBottom" *ngIf="loggedIn" id="commentButton" md-button color="accent" [disabled]="loading" (click)="postComment()"><i class="material-icons">send</i></button>

<md-menu #commentMenu="mdMenu">
  <button md-menu-item (click)="addBold()"><i class="material-icons">format_bold</i> Bold</button>
  <button md-menu-item (click)="addItalics()"><i class="material-icons">format_italic</i> Italic</button>
  <button md-menu-item (click)="addStrikethrough()"><i class="material-icons">strikethrough_s</i> Strikethrough</button>
  <button md-menu-item (click)="addBlockQoutes()"><i class="material-icons">format_quote</i> Quote</button>
  <button *ngIf="imageData === null" md-menu-item (click)="addImage()"><i class="material-icons">image</i> Add Image</button>
  <button *ngIf="imageData !== null" md-menu-item (click)="deleteImage()"><i class="material-icons">image</i> Delete Image</button>
</md-menu>

<md-list>
  <div *ngFor="let comment of post?.comments">
    <md-card [style.border]="notificationIndication(comment?.id)" class="content">
      <div class="commentEditing">
        <button md-icon-button [mdMenuTriggerFor]="appMenu"><i class="material-icons">more_vert</i></button>
        <md-menu #appMenu="mdMenu">
          <button md-menu-item type="button" (click)="share(comment.id)"><md-icon>share</md-icon>Share Comment</button>
          <button *ngIf="comment.author?.user == userID" md-menu-item color="warn" (click)="openCommentDeleteDialog(comment)"><md-icon>delete</md-icon>Delete Comment</button>
          <button *ngIf="!(comment.author?.user == userID) && loggedIn" md-menu-item (click)="openFlagDialog(post, comment, typeOfReport.Comment)"><md-icon>flag</md-icon>Flag Comment</button>
        </md-menu>
      </div>
      <div class="commentText" innerHTML="{{comment.text | marked: post : comment}}"></div>
      <a target="_blank" rel="noopener" href="{{comment?.image}}"><img class="wfImages" *ngIf="comment?.image" src="{{comment?.image}}" /></a>
      <md-card (click)="gotoUser(comment.author?.user)" class="parentContainer1">
        <div class="parentContainer">
          <img class="pfp2" (click)="gotoUser(comment.author?.user)" *ngIf="comment.author?.avatar" [src]="comment.author?.avatar" alt="Avatar of {{comment.author?.name}}"/>
          <img class="pfp2" (click)="gotoUser(comment.author?.user)" *ngIf="!comment.author?.avatar" src="/assets/logo.png" alt="Avatar of {{comment.author?.name}}"/>
          <ng-container class="user">
            <br>
            <i><small><a class="dateText" routerLink="/user/{{comment.author?.user}}" (click)="gotoUser(comment.author?.user)" routerLinkActive="active">{{comment.author?.name}}</a><br> <p>{{comment.created}}</p></small></i>
          </ng-container>
        </div>
      </md-card>
    </md-card>
  </div>
</md-list>

<md-card class="refreshButton" (click)="ngOnInit()" *ngIf="(commentCount === 0) && !loading">
    No comments, try commenting?
    <button class="wideButtons" md-button>Refresh <i class="material-icons">refresh</i></button>
</md-card>
